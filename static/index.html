<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <script src="https://unpkg.com/petite-vue" defer init></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

</head>

<body class="p-3">
    <h1>Bergflix. Partymode</h1>
    <h2><span class="badge bg-success">URL</span> {{window.location.href}}</h2>
    <pre>
        <code>
const socket = io("{{window.location.href}}");
        </code>
    </pre>



    <!-- Six expandable sections, one for each event, each with a Badge and Title, and a codeblock and description as content -->
    <!-- Events:
      socket.on('join', async (roomName: string, callback) => {
    if (!checkCb(callback)) return;
    await leaveAllRooms();
    // Join the new room
    const room = await joinRoom(roomName, socket.id)
    if (room.error) {
      logger.error(room.error.message);
      callback({ error: room.error });
      return;
    }
    socket.join(roomName);
    logger.info(`Socket ${socket.id} joined room ${roomName}`);
    callback({ data: room.data });
    const user = await getUser(socket.id);
    socket.broadcast.to(roomName).emit('join', { data: { socket: socket.id, user: user.data } });
  });

  // Leave a room
  socket.on('leave', leaveAllRooms);

  // Authenticate
  socket.on('authenticate', async (token: string, callback) => {
    if (!checkCb(callback)) return;
    const user = await authenticateUser(token, socket.id);
    if (user.error) logger.error(user.error.message);
    callback(user);
  });

  // Sync event
  socket.on('sync', async (data: Partial<IRoom>, manual?, callback?) => {
    if (!checkCb(callback)) return;
    // Get the room the user is in
    const roomName = await Array.from(socket.rooms.keys())[1];
    const isPermitted = await checkPerms(data, roomName, socket.id);
    const room = await syncRoom(roomName, data);
    const err = isPermitted.error || room.error
    if (err) {
      logger.error(err.message);
      callback({ error: err })
      return;
    }
    socket.to(roomName).emit('sync', { data: { room: room.data, manual } });
    callback({ data: room.data });
  });

  // Message event
  socket.on('message', async (message: string, callback) => {
    if (!checkCb(callback)) return;
    // Get the room the user is in
    const roomName = await Array.from(socket.rooms.keys())[1];
    const user = await getUser(socket.id);
    const data = { data: { socket: socket.id, user: user.data, message } };
    socket.to(roomName).emit('message', data);
    callback(data);
  });
 -->
    <div class="accordion" id="accordionExample">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne"
                    aria-expanded="false" aria-controls="collapseOne">
                    <span class="badge bg-info mx-1">Type</span>
                    <!-- <span class="badge bg-warning mx-1">Acknowledgement</span> -->
                    <strong>IRoom</strong> - Room Object
                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <pre>
                        <code class="language-ts">
export interface IRoom {
    name: string;
    queue: string[];
    owner: string;
    currentVideo: string;
    currentTime: number;
    playing: boolean;
    permissions: {
        user: Partial&ltIRoomPermissions&gt;
        guest: Partial&ltIRoomPermissions&gt;
    }
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo"
                    aria-expanded="false" aria-controls="collapseTwo">
                    <span class="badge bg-info mx-1">Type</span>
                    <!-- <span class="badge bg-warning mx-1">Acknowledgement</span> -->
                    <strong>IRoomPermissions</strong> - Room Object
                </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <pre>
                        <code class="language-ts">
export interface IRoomPermissions {
    name: boolean;
    queue: boolean;
    owner: boolean;
    video: boolean;
    time: boolean;
    playback: boolean;
    permissions: boolean;
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree"
                    aria-expanded="false" aria-controls="collapseThree">
                    <span class="badge bg-info mx-1">Type</span>
                    <!-- <span class="badge bg-warning mx-1">Acknowledgement</span> -->
                    <strong>IUser</strong> - User Object
                </button>
            </h2>
            <div id="collapseThree" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <pre>
                        <code class="language-ts">
export interface IUser {
    id: number;
    username: string;
    email?: string;
    provider?: string;
    confirmed?: boolean;
    blocked?: boolean;
    createdAt?: string;
    updatedAt?: string;
    admin: boolean;
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFour"
                    aria-expanded="false" aria-controls="collapseFour">
                    <span class="badge bg-info mx-1">Type</span>
                    <!-- <span class="badge bg-warning mx-1">Acknowledgement</span> -->
                    <strong>BaseReturn</strong> - Base Return Object
                </button>
            </h2>
            <div id="collapseFour" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <pre>
                        <code class="language-ts">
export interface BaseReturn&ltT = unknown&gt {
    error?: {
        message: string;
        code: number;
    };
    data?: T;
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseFive"
                    aria-expanded="false" aria-controls="collapseFive">
                    <span class="badge bg-success mx-1">Event</span>
                    <span class="badge bg-warning mx-1">Acknowledgement</span>
                    <strong>join</strong> - Join a room
                </button>
            </h2>
            <div id="collapseFive" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-success mx-1">Sent</span> <code>("join", [roomName])</code> Send to
                            join a room, requires room name. If the room doesnt exist, it will be created.
                            <p>
                                <span class="badge bg-warning mx-1">Acknowledgement</span>
                                <code>BaseReturn&lt;IRoom&gt;</code>
                            </p>
                        </li>
                        <li>
                            <span class="badge bg-info mx-1">Emitted</span> to other sockets in room.
                            <code>BaseReturn&lt;{ socket: string, user?: IUser }&gt;</code>.
                        </li>
                    </ul>
                    <pre>
                        <code class="language-ts">
socket.emit("join", "roomName", (data: BaseReturn&lt;IRoom&gt;) => {
    if (data.error) {
        console.error(data.error);
        return;
    }
    console.log(data.data); // Room Object
});
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSix"
                    aria-expanded="false" aria-controls="collapseSix">
                    <span class="badge bg-success mx-1">Event</span>
                    <span class="badge bg-warning mx-1">Acknowledgement</span>
                    <strong>leave</strong> - Leave a room
                </button>
            </h2>
            <div id="collapseSix" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-success mx-1">Sent</span> <code>("leave")</code> Send to leave a room.
                            <p>
                                <span class="badge bg-warning mx-1">Acknowledgement</span> <span
                                    class="badge bg-danger mx-1">Optional</span>
                                <code>BaseReturn&lt;{ data: { rooms: string[] } }&gt;</code>
                            </p>
                        </li>
                        <li>
                            <span class="badge bg-info mx-1">Emitted</span> to other sockets in room.
                            <code>BaseReturn&lt;{ socket: string, user?: IUser }&gt;</code>.
                        </li>
                    </ul>
                    <pre>
                        <code class="language-ts">
socket.emit("leave", (data: BaseReturn&lt;{ data: { rooms: string[] } }&gt;) => {
    if (data.error) {
        console.error(data.error);
        return;
    }
    console.log(data.data); // { rooms: string[] }
});
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <!-- authenticate -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSeven"
                    aria-expanded="false" aria-controls="collapseSeven">
                    <span class="badge bg-success mx-1">Event</span>
                    <span class="badge bg-warning mx-1">Acknowledgement</span>
                    <strong>authenticate</strong> - Authenticate a user
                </button>
            </h2>
            <div id="collapseSeven" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-success mx-1">Sent</span> <code>("authenticate", [token])</code> Send
                            to authenticate a user, requires a token.
                            <p>
                                <span class="badge bg-warning mx-1">Acknowledgement</span>
                                <code>BaseReturn&lt;IUser&gt;</code>
                            </p>
                        </li>
                    </ul>
                    <pre>
                        <code class="language-ts">
socket.emit("authenticate", "token", (data: BaseReturn&lt;IUser&gt;) => {
    if (data.error) {
        console.error(data.error);
        return;
    }
    console.log(data.data, data.data.email); // [User Object, undefined]; Returns only publicly available data.
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <!-- Sync  -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseEight"
                    aria-expanded="false" aria-controls="collapseEight">
                    <span class="badge bg-success mx-1">Event</span>
                    <span class="badge bg-warning mx-1">Acknowledgement</span>
                    <strong>sync</strong> - Sync a user with a room
                </button>
            </h2>
            <div id="collapseEight" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-success mx-1">Sent</span>
                            <code>("sync", Partial&lt;IRoom&gt;, bool)</code> Send to
                            sync a user with a room, requires room name. If the room doesnt exist, it will be created.
                            <p>
                                <span class="badge bg-warning mx-1">Acknowledgement</span>
                                <code>BaseReturn&lt;IRoom&gt;</code>
                            </p>
                        </li>
                        <li>
                            <span class="badge bg-info mx-1">Emitted</span> to other sockets in room.
                            <code>BaseReturn&lt;{ room: IRoom, manual?: bool }&gt;</code>.
                        </li>
                    </ul>
                    <pre>
                        <code class="language-ts">
socket.emit("sync", { name: "room" }, true, (data: BaseReturn&lt;{ room: IRoom, manual?: bool }&gt;) => {
    if (data.error) {
        console.error(data.error);
        return;
    }
    console.log(data.data.name, data.data.owner); // Returns full room object, not just updated.
}
</code>
</pre>
                </div>
            </div>
        </div>
        <!-- Message -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseNine"
                    aria-expanded="false" aria-controls="collapseNine">
                    <span class="badge bg-success mx-1">Event</span>
                    <span class="badge bg-warning mx-1">Acknowledgement</span>
                    <strong>message</strong> - Send a message to a room
                </button>
            </h2>
            <div id="collapseNine" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-success mx-1">Sent</span>
                            <code>("message", string)</code> Send to
                            send a message to a room.
                            <p>
                                <span class="badge bg-warning mx-1">Acknowledgement</span>
                                <code>BaseReturn&lt;{ socket: string, user?: IUser, message: string }&gt;</code>
                            </p>
                        </li>
                        <li>
                            <span class="badge bg-info mx-1">Emitted</span> to other sockets in room.
                            <code>BaseReturn&lt;{ socket: string, user?: IUser, message: string }&gt;</code>.
                        </li>
                    </ul>
                    <pre>
                        <code class="language-ts">
socket.emit("message", "Hello World!", (data: BaseReturn&lt;{ socket: string, user?: IUser, message: string }&gt;) => {
    if (data.error) {
        console.error(data.error);
        return;
    }
    console.log(data.data.message, data.data.user); // [string, IUser || undefined]; Only returns user if authenticated.
}
                        </code>
                    </pre>
                </div>
            </div>
        </div>
        <!-- Error -->
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTen"
                    aria-expanded="false" aria-controls="collapseTen">
                    <span class="badge bg-success mx-1">Event</span>
                    <strong>error</strong> - Error event
                </button>
            </h2>
            <div id="collapseTen" class="accordion-collapse collapse " aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">
                    <ul>
                        <li>
                            <span class="badge bg-info mx-1">Emitted</span>
                            <code>BaseReturn&lt;{ message: string }&gt;</code> Emitted when an error occurs.
                        </li>
                    </ul>
                    <pre>
                    <code class="language-ts">
socket.on("error", (data: BaseReturn&lt;{ message: string }&gt;) => {
    console.error(data.error);
}
                    </code>
                </pre>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
</body>

</html>